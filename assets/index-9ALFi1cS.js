(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();class p{constructor(e,t,i){this.type=e,this.shape=t,this.color=i,this.x=0,this.y=0,this.boardWidth=10,this.boardHeight=20}canMove(e,t=0,i=0,s=10,r=20){const o=this.x+t,c=this.y+i;if(o<0||o+this.shape[0].length>s||c+this.shape.length>r)return!1;if(!e)return!0;for(let l=0;l<this.shape.length;l++)for(let u=0;u<this.shape[l].length;u++)if(this.shape[l][u]&&e[c+l]&&e[c+l][o+u])return!1;return!0}moveTo(e,t){this.x+=e,this.y+=t}rotate(){JSON.parse(JSON.stringify(this.shape));const e=this.shape;this.y;const t=[];for(let i=0;i<this.shape[0].length;i++){t[i]=[];for(let s=0;s<this.shape.length;s++)t[i][s]=this.shape[s][i]}return this.rotation=(this.rotation+90)%360,this.canMove(null,0,0,this.boardWidth,this.boardHeight)?this.shape=t:this.shape=e,t}}class v{constructor(e,t){this.width=e,this.height=t,this.grid=Array(t).fill().map(()=>Array(e).fill(null))}mergePiece(e){if(e){for(let t=0;t<e.shape.length;t++)for(let i=0;i<e.shape[t].length;i++)if(e.shape[t][i]){const s=e.x+i,r=e.y+t;r>=0&&r<this.height&&s>=0&&s<this.width&&(this.grid[r][s]=e.color)}}}isEmpty(e,t){return this.grid[t]&&this.grid[t][e]===null}set(e,t,i){t>=0&&t<this.height&&e>=0&&e<this.width&&(this.grid[t][e]=i)}get(e,t){return t>=0&&t<this.height&&e>=0&&e<this.width?this.grid[t][e]:null}clearLines(){let e=0;for(let t=this.height-1;t>=0;t--)this.grid[t].every(i=>i!==null)&&(e++,this.grid.splice(t,1),this.grid.unshift(Array(this.width).fill(null)),t++);return e}clear(){this.grid=Array(this.height).fill().map(()=>Array(this.width).fill(null))}isGameOver(){return this.grid[0].some(e=>e!==null)}getGrid(){return JSON.parse(JSON.stringify(this.grid))}}class S{constructor(){this.board=document.getElementById("game-board"),this.width=10,this.height=20,this.cellSize=22,this.cells=[],this.initializeBoard()}initializeBoard(){this.board.innerHTML="";for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){const i=document.createElement("div");i.className="cell",i.style.width=`${this.cellSize}px`,i.style.height=`${this.cellSize}px`,this.board.appendChild(i),this.cells.push(i)}}getCellIndex(e,t){return e*this.width+t}updateCell(e,t,i=null){const s=this.getCellIndex(e,t);s<this.cells.length&&(this.cells[s].style.backgroundColor=i||"#000")}clearCells(){this.cells.forEach(e=>{e.style.backgroundColor="#000",e.classList.remove("active","filled"),e.style.transition="none",setTimeout(()=>{e.style.transition="background-color 0.2s, transform 0.2s"},0)})}drawPiece(e){for(let t=0;t<e.shape.length;t++)for(let i=0;i<e.shape[t].length;i++)if(e.shape[t][i]){const s=e.x+i,r=e.y+t;if(r>=0&&r<this.height){const o=this.getCellIndex(r,s);o<this.cells.length&&(this.cells[o].classList.add("active"),this.cells[o].style.backgroundColor=e.color)}}}drawGrid(e){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){const s=e.get(i,t);if(s){const r=this.getCellIndex(t,i);r<this.cells.length&&(this.cells[r].classList.add("filled"),this.cells[r].style.backgroundColor=s)}}}}class P{constructor(){this.gameOver=!1,this.score=0,this.lines=0,this.dropSpeed=1e3,this.softDropSpeed=100,this.isSoftDropping=!1,this.softDropTimer=null,this.eventListeners=new Set}reset(){this.score=0,this.lines=0,this.gameOver=!1,this.dropSpeed=1e3,this.isSoftDropping=!1,this.softDropTimer=null}updateScore(e){this.score+=e}updateLines(e){this.lines+=e}toggleSoftDrop(){this.isSoftDropping=!this.isSoftDropping}}class D{constructor(e){this.game=e}movePiece(e,t){if(!this.game.currentPiece)return!1;const i=this.game.currentPiece.x+e,s=this.game.currentPiece.y+t;return this.canPieceMove(i,s)?(this.game.currentPiece.x=i,this.game.currentPiece.y=s,!0):!1}rotatePiece(){if(!this.game.currentPiece)return;const e=this.game.currentPiece.x,t=this.game.currentPiece.y,i=this.game.currentPiece.rotate();if(this.canPieceMove(e,t))return this.game.currentPiece.shape=i,!0;for(let s=-2;s<=2;s++)for(let r=-2;r<=2;r++)if(this.canPieceMove(e+s,t+r))return this.game.currentPiece.x=e+s,this.game.currentPiece.y=t+r,this.game.currentPiece.shape=i,!0;return this.game.currentPiece.x=e,this.game.currentPiece.y=t,!1}canPieceMove(e,t){const i=this.game.currentPiece;if(!i)return!1;for(let s=0;s<i.shape.length;s++)for(let r=0;r<i.shape[s].length;r++)if(i.shape[s][r]===1){const o=e+r,c=t+s;if(o<0||o>=this.game.grid.width||c>=this.game.grid.height||c>=0&&this.game.grid.grid[c][o])return!1}return!0}}const f={BOARD_WIDTH:10,BOARD_HEIGHT:20,COLORS:{I:"#00FFFF",J:"#0000FF",L:"#FFA500",O:"#FFFF00",S:"#00FF00",T:"#9400D3",Z:"#FF0000"},TETROMINOS:{I:[[1,1,1,1]],J:[[1,0,0],[1,1,1]],L:[[0,0,1],[1,1,1]],O:[[1,1],[1,1]],S:[[0,1,1],[1,1,0]],T:[[0,1,0],[1,1,1]],Z:[[1,1,0],[0,1,1]]},KEY_DEBOUNCE:100};class O{constructor(e){this.game=e,this.setupKeyboardEvents(),this.setupTouchEvents()}setupKeyboardEvents(){const{KEY_DEBOUNCE:e}=f;let t=0;document.addEventListener("keydown",i=>{if(this.game.gameState.gameOver)return;const s=Date.now();if(!(s-t<e)){switch(t=s,i.key){case"ArrowLeft":this.game.movePiece(-1,0);break;case"ArrowRight":this.game.movePiece(1,0);break;case"ArrowDown":this.game.softDrop();break;case"ArrowUp":this.game.movement.rotatePiece();break;case" ":this.game.stopSoftDrop();break}this.game.render()}})}setupTouchEvents(){const e=document.getElementById("game-board");if(!e){console.error("No se pudo encontrar el elemento game-board");return}let t=0,i=0,s=!1,r=0;const o=300;e.addEventListener("touchstart",a=>{if(this.game.gameState.gameOver)return;const n=Date.now();n-r<o&&(this.game.movement.rotatePiece(),this.game.render()),r=n,t=a.touches[0].clientX,i=a.touches[0].clientY,s=!1}),e.addEventListener("touchmove",a=>{if(this.game.gameState.gameOver)return;const n=a.touches[0].clientX,m=a.touches[0].clientY,g=n-t,d=m-i;(Math.abs(g)>50||Math.abs(d)>50)&&(s=!0)}),e.addEventListener("touchend",a=>{this.game.gameState.gameOver||s||(this.game.movement.rotatePiece(),this.game.render())}),e.addEventListener("touchstart",a=>{this.game.gameState.gameOver||(t=a.touches[0].clientX,i=a.touches[0].clientY)}),e.addEventListener("touchmove",a=>{if(this.game.gameState.gameOver)return;const n=a.touches[0].clientX,m=a.touches[0].clientY,g=n-t,d=m-i;Math.abs(g)>20&&(this.game.movePiece(g>0?1:-1,0),t=n),Math.abs(d)>20&&(this.game.softDrop(),i=m)}),e.addEventListener("touchend",()=>{this.game.gameState.gameOver||this.game.stopSoftDrop()});let c=!1,l=0;const u=100;e.addEventListener("touchstart",a=>{if(this.game.gameState.gameOver)return;a.preventDefault();const n=a.touches[0];t=n.clientX,i=n.clientY,c=!0,l=Date.now()}),e.addEventListener("touchmove",a=>{if(!c||this.game.gameState.gameOver)return;a.preventDefault();const n=a.touches[0],m=n.clientX-t,g=n.clientY-i,d=Date.now();d-l<u||(Math.abs(m)>20&&Math.abs(m)>Math.abs(g)&&(m>0?this.game.movePiece(1,0):this.game.movePiece(-1,0),t=n.clientX,l=d),Math.abs(g)>20&&Math.abs(g)>Math.abs(m)&&(g>0?this.game.gameState.isSoftDropping||this.game.softDrop():this.game.rotatePiece(),i=n.clientY,l=d),this.game.render())}),e.addEventListener("touchend",()=>{c=!1,this.game.gameState.isSoftDropping&&this.game.stopSoftDrop()})}}class y{constructor(){this.board=new S,this.grid=new v(f.BOARD_WIDTH,f.BOARD_HEIGHT),this.currentPiece=null,this.gameInterval=null,this.gameState=new P,this.movement=new D(this),this.events=new O(this),this.initializeGame()}initializeGame(){this.grid.clear(),this.gameState.reset(),this.currentPiece=null,this.gameInterval=null,this.stopGame(),this.render()}startGame(){this.initializeGame(),this.gameState.gameOver=!1,this.createPiece(),this.gameInterval=setInterval(()=>{this.gameState.gameOver||(this.gameState.isSoftDropping?this.gameState.softDropSpeed:this.gameState.dropSpeed,this.movePiece(0,1)||(this.lockPiece(),this.gameState.gameOver=this.grid.isGameOver()))},this.gameState.dropSpeed)}stopGame(){this.gameInterval&&(clearInterval(this.gameInterval),this.gameInterval=null),this.gameState.softDropTimer&&(clearInterval(this.gameState.softDropTimer),this.gameState.softDropTimer=null)}movePiece(e,t){if(!this.currentPiece)return!1;const i=this.currentPiece.x+e,s=this.currentPiece.y+t;return this.movement.canPieceMove(i,s)?(this.board.clearCells(),this.currentPiece.x=i,this.currentPiece.y=s,this.render(),!0):!1}createPiece(){const e=Object.keys(f.TETROMINOS),t=e[Math.floor(Math.random()*e.length)],i=f.TETROMINOS[t],s=f.COLORS[t];this.currentPiece=new p(t,i,s),this.currentPiece.x=Math.floor((this.board.width-i[0].length)/2),this.currentPiece.y=0,this.movement.canPieceMove(this.currentPiece.x,this.currentPiece.y)||(this.gameState.gameOver=!0,this.stopGame())}resetGame(){this.initializeGame(),this.startGame()}lockPiece(){if(this.currentPiece){this.board.clearCells(),this.grid.mergePiece(this.currentPiece);const e=this.grid.clearLines();e>0&&(this.gameState.updateScore(e*100),this.gameState.updateLines(e)),this.gameState.isSoftDropping&&(this.gameState.toggleSoftDrop(),this.gameState.softDropTimer&&(clearInterval(this.gameState.softDropTimer),this.gameState.softDropTimer=null)),this.createPiece(),this.render()}}softDrop(){this.gameState.isSoftDropping||(this.gameState.toggleSoftDrop(),this.gameState.softDropTimer=setInterval(()=>{this.gameState.gameOver||this.movePiece(0,1)||(this.lockPiece(),this.gameState.toggleSoftDrop())},this.gameState.softDropSpeed))}stopSoftDrop(){this.gameState.isSoftDropping&&this.gameState.softDropTimer&&(clearInterval(this.gameState.softDropTimer),this.gameState.softDropTimer=null,this.gameState.toggleSoftDrop(),this.gameInterval&&(clearInterval(this.gameInterval),this.gameInterval=setInterval(()=>{this.gameState.gameOver||this.movePiece(0,1)||(this.lockPiece(),this.gameState.gameOver=this.grid.isGameOver())},this.gameState.dropSpeed)))}render(){this.board.clearCells(),this.board.drawGrid(this.grid),this.currentPiece&&this.board.drawPiece(this.currentPiece)}}function w(){const h=new y,e=document.getElementById("start-button"),t=document.getElementById("game-over"),i=document.getElementById("restart-button");e.addEventListener("click",()=>{h.resetGame(),h.startGame(),e.disabled=!0,t.classList.add("hidden")}),i.addEventListener("click",()=>{h.resetGame(),h.startGame(),e.disabled=!0,t.classList.add("hidden")}),window.addEventListener("load",()=>{window.innerWidth<=768&&(e.classList.add("hidden"),h.resetGame(),h.startGame(),e.disabled=!0,t.classList.add("hidden"))})}document.addEventListener("DOMContentLoaded",w);
